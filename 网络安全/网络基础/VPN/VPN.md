# VPN

> 💡VPN=加密+隧道

# 隧道协议

### 隧道技术

-   隧道技术指的是通过一种协议（承载协议）来传送另一种协议（载荷协议）的技术，使用承载协议建立隧道，隧道里传递的数据包都是载荷协议类型。
-   可以让一种网络不支持的外来协议通过该网络
-   隧道的客户机和服务器双方必须使用相同的隧道协议
-   第二层隧道协议，使用帧作为数据交换单位
-   第三层隧道协议，使用包作为数据交换单位，是将IP包封装在附加的IP包头中，通过IP网络传送

### 隧道技术功能

-   将数据流强制送到特定的地址
-   隐藏私有的网络地址
-   在IP网上传递非IP数据报
-   提供数据安全支持

### GRE协议

-   Generic Routing Encapsulation：通用路由封装协议
-   是VPN的第三层隧道协议
-   协议号为47
-   GRE隧道两端的两个私网的IP地址不可以在同一网段，否则无法通信

### GRE封装过程

1.  IP头+数据
2.  GRE头+IP头+数据（通过GRE模块）
3.  新IP头+GRE头+IP头+数据

### GRE配置过程

1.  创建虚拟Tunnel接口
2.  指定Tunnel的源端
3.  指定Tunnel的目的端
4.  设置Tunnel接口的网络地址
5.  配置通过Tunnel的路由

### 隧道协议

-   二层隧道VPN

    L2TP

    PPTP
-   三层隧道VPN

    GRE

    IPSEC

    MPLS VPN
-   应用层VPN

    SSL VPN

    Web VPN

### 第二层隧道协议

-   建立在点对点协议PPP的基础上
-   把网络协议封装到PPP帧中，再装入隧道协议

### 第三层隧道协议

-   把网络协议直接装入隧道协议
-   在课扩充性、安全性、可靠性方面优于第二层隧道协议

# IPSec

### IPSec的定义

-   IP Security 保证在Internet上传送数据的安全保密性而制定的框架协议
-   应用在网络层，保护和认证IP数据包
-   最主要功能是保护VPN数据的安全传输
-   支持隧道模式和传输模式

### IPSec的工作模式

-   隧道模式

    对整个IP数据包封装加密，隐蔽源和目的IP，从外部看不到数据包的路由过程
-   传输模式

    只对IP有效数据进行封装加密，源和目的IP不加密

### IPSec的组成

-   两个安全协议

    AH：（ Authentication Header ) 认证头协议

    ESP： ( Encapsulation Security Payload ) 封装安全载荷协议
-   密钥管理协议

    IKE：（ Internet Key Exchange ）因特网密钥交换协议

# SSL VPN

（ Secure Socket Layer  ）安全套接字，是Web浏览器和Web服务器之间安全交换信息的协议，提供鉴别和保密；介于应用层和TCP层之间，应用层传输给SSL层，数据加密后增加SSL头，发给传输层

### SSL的工作原理

主要使用三种协议

-   握手协议
-   记录协议
-   警报协议

### SSL的特点

-   保密
-   鉴别
-   完整性
