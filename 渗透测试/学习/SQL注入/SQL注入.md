# SQL注入

[常用SQL语句](../常用SQL语句/常用SQL语句.md)

## 联合注入

> 💡原理：通过结束符截断前面的条件，后面通过and、union等语句添加新的条件构造成一句新的sql语句

## 报错注入

> 💡原理：后台没有屏蔽掉数据库的报错信息，会将发生错误回显在前端，通过报错信息获取信息

常用的报错函数：updatexml()，extractvalue()，floor() ,exp()

## 布尔盲注

> 💡原理：后台屏蔽了报错信息，但是页面也两种状态，一种是报错一种是正常，于是可以通过状态去判断信息

常用的判断方法：length()、substr()、ascii()

## 时间盲注

> 💡原理 ：后台屏蔽了报错信息，并且只有一种状态，这是可以通过页面响应的时长来判断信息

常用的函数：sleep()、benchmark()

## 堆叠注入

> 💡原理：堆叠注入是利用分号（;）结束一条sql语句，后面再构造一条sql语句

> 💡使用条件很苛刻，需要利用`mysqli_multi_query()`函数支持多条sql语句同时执行，但是往往使用的都是`mysqli_query()`，只能执行一条语句

> 💡堆叠注入构造的sql语句可以使用select、insert、update、create、delete等语句，因此堆叠注入的危害是是最大的

-   使用[PDO](https://www.wolai.com/2Kvi1o8dMhfe6T5R1oVTqk.md "PDO")执行sql语句时，可执行多条语句，但是只会返回第一条SQL语句的执行结果，因此第二条语句可以使用update更新数据或者盲注获取数据

```sql
payload= ';select if (length(database())>5,sleep(5),1)# 
```

## 二次注入

> 💡原理：将恶意Payload存储在数据库里，当web程序调用这条数据的时候将执行这恶意Payload，这就发生了二次注入

> 💡一般存储密码的字段都会进行MD5哈希加密，因此不能在这些地方注入

经典案例：知道用户 admin 但是不知道密码

1.  注册一个 admin'#用户&#x20;
2.  修改 admin'#的密码 `Update users set password='new_pass' where username='admin'#'and password='123456'`
3.  实际上 `Update users set password='new_pass' where username='admin'`

## 宽字节注入

> 💡原理：gbk编码汉字占两个字节，转义字符（ \ ）符合第一个字节的范围，在（ \ ）后面添加一个符合第二个字节范围的字符`%df`，就可以和（ \ ）一起解析成一个汉字，从而吃掉（ \ ）

> 💡gbk编码取值范围：第一个字节（129-254），第二个字节（64-254）

-   宽字节编码原理：宽字节编码一个字符占1个字节或者多个字节，2个字节以上叫宽字节；gbk编码时，遇到连续两个字节都符合取值范围，会自动解析成一个字符
-   字符是组成字符集的基本单位，字符序是字符在该字符集中的位置
-   常用的宽字节编码：GB2312、GBK、GB18030、BIG5、Shift\_JIS&#x20;
-   因为一般会对符号( ' )做转义，所以直接用一句话爆表和爆字段SQL 代码块

## cookie注入

> 💡原理：cookie注入和传统的sql注入一致，只是payload注入点不同

如何判断是否存在cookie注入：

-   url带参数`"?id=1"`
-   去掉参数，如果显示不正常，说明参数在传递是起直接作用
-   去掉参数，如果显示正常，说明是使用cookie传递参数

## base64注入

> 💡原理：当传递的参数可能是经过base64编码后再传递的，则可以将payload进行base64编码再注入，此时WAF可能检测不到危险代码，进而绕过

-   注释要用#

## HTTP头部注入

> 💡原理：类似于cookie注入，不过注入点在useragent和referer

## SQL注入原理

> 💡WEB应用程序没有对用户输入的参数进行过滤和判断，攻击者构造恶意的sql语句来实现对数据库进行操作

条件：

1.  用户有可控的参数
2.  参数带入数据库查询

## SQL注入危害

-   数据库信息泄露
-   网页篡改：通过操作数据库对特定网页进行篡改，嵌入网马链接，进行挂马攻击。
-   数据库被恶意操作：数据库服务器被攻击，数据库的系统管理员帐户被更改。
-   服务器被远程控制：黑客可以修改或控制操作系统。
-   种植木马：瘫痪全系统
